
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Nilearn: Machine learning for NeuroImaging in Python &#8212; Machine learning for NeuroImaging</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8.2.1. Basic Atlas plotting" href="01_plotting/plot_atlas.html" />
    <link rel="prev" title="8.1.3. 3D and 4D niimgs: handling and visualizing" href="plot_3d_and_4d_niimg.html" />
<meta content="True" name="HandheldFriendly">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="keywords" content="nilearn, neuroimaging, python, neuroscience, machinelearning">


<script type="text/javascript">
function updateTopMenuPosition(height, width) {
    if($(window).scrollTop() > height && $(window).outerWidth() > 1024) {
        //begin to scroll
        $('.related-wrapper').css("z-index", 1000)
        $('.related-wrapper').css("position", "sticky")
        $('.related-wrapper').css("top", 0)
        $('.related-wrapper').css("width", width)
    } else {
        //lock it back into place
        $('.related-wrapper').css("position", "relative")
        $('.related-wrapper').css("top", 0)
    }
}

$(function() {
    var banner_height = $('#logo-banner').outerHeight()
    var banner_width = $('#logo-banner').outerWidth()
    var width = $('.related-wrapper').css("height", $('.related').outerHeight())

    updateTopMenuPosition(banner_height, width)

    $(window).scroll(function(event) {
        updateTopMenuPosition(banner_height, width)
    });

    $(window).resize(function(event) {
        var banner_width = $('#logo-banner').outerWidth()
        var menu_height = $('.related').outerHeight()
        $('.related').css("width", banner_width)
        $('.related-wrapper').css("height", menu_height)
        updateTopMenuPosition(banner_height, width)
    })
});
</script>
<script type="text/javascript">
function updateSideBarPosition(top, offset, sections) {
    var pos = $(window).scrollTop()
    // Lock the table of content to a fixed position once we scroll enough
    var topShift = 2 * offset
    if(pos > top + topShift + 1) {
        // begin to scroll with sticky menu bar
        var topShift = -topShift + 1
        if ($(window).outerWidth() < 1024) {
            // compensate top menu that disappears
            topShift -= offset + 1
        }
        $('.sphinxsidebarwrapper').css("position", "fixed")
        $('.sphinxsidebarwrapper').css("top", topShift)
    }
    else {
        //lock it back into place
        $('.sphinxsidebarwrapper').css("position", "relative")
        $('.sphinxsidebarwrapper').css("top",0)
    }

    // Highlight the current section
    i = 0
    current_section = 0
    $('a.internal').removeClass('active')
    for(i in sections) {
        if(sections[i] > pos) {
            break
        };
        if($('a.internal[href$="' + i + '"]').is(':visible')){
            current_section = i
        };
    }
    $('a.internal[href$="' + current_section + '"]').addClass('active')
    $('a.internal[href$="' + current_section + '"]').parent().addClass('active')
}

$(function () {
    // Lock the table of content to a fixed position once we scroll enough
    var tocOffset = $('.related-wrapper').outerHeight()
    var marginTop = parseFloat($('.sphinxsidebarwrapper').css('margin-top').replace(/auto/, 0))
    var top = $('.sphinxsidebarwrapper').offset().top - marginTop
    sections = {}
    url = document.URL.replace(/#.*$/, "")

    // Grab positions of our sections
    $('.headerlink').each(function(){
        sections[this.href.replace(url, '')] = $(this).offset().top - 50
    });

    updateSideBarPosition(top, tocOffset, sections)

    $(window).scroll(function(event) {
        updateSideBarPosition(top, tocOffset, sections)
    });

    $(window).resize(function(event) {
        tocOffset = $('.related-wrapper').outerHeight()
        updateSideBarPosition(top, tocOffset, sections)
    });
});
</script>


<script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-41920728-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

  </head><body>
<div id="logo-banner">
  <div class="logo">
    <a href="../index.html">
      <img src="../_static/nilearn-logo.png" alt="Nilearn logo"  border="0" />
    </a>
  </div>
  <!-- A tag cloud to make it easy for people to find what they are
                         looking for -->
 <div class="tags">
  <ul>
    <li>
      <big><a href="decoding/plot_haxby_anova_svm.html">SVM</a></big>
    </li>
    <li>
      <small><a href="../connectivity/parcellating.html">Ward
          clustering</a></small>
    </li>
    <li>
      <a href="../decoding/searchlight.html">Searchlight</a>
    </li>
    <li>
      <big><a href="../connectivity/resting_state_networks.html">ICA</a></big>
    </li>
    <li>
      <a href="../manipulating_images/data_preparation.html">Nifti IO</a>
    </li>
    <li>
      <a href="../modules/reference.html#module-nilearn.datasets">Datasets</a>
    </li>
  </ul>
 </div>

  <div class="banner">
    <h1>Nilearn:</h1>
    <h2>Machine learning for Neuro-Imaging in Python</h2>
  </div>
  <div class="search_form">
    <div class="gcse-search" id="cse" style="width: 100%;"></div>
    <script>
      (function() {
        var cx = '017289614950330089114:elrt9qoutrq';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
  </div>
</div>



<div class=related-wrapper>
    
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="01_plotting/plot_atlas.html" title="8.2.1. Basic Atlas plotting"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_3d_and_4d_niimg.html" title="8.1.3. 3D and 4D niimgs: handling and visualizing"
             accesskey="P">previous</a> |</li>
<li><a href="../index.html">Nilearn Home</a> |&nbsp;</li>
<li><a href="../user_guide.html">User Guide</a> |&nbsp;</li>
<li><a href="index.html">Examples</a> |&nbsp;</li>
<li><a href="../modules/reference.html">Reference</a> |&nbsp;</li>
<li id="navbar-about"><a href="../authors.html">About</a>|&nbsp;</li>
<li id="navbar-ecosystem"><a href="http://www.nipy.org/">Nipy ecosystem</a></li>

          <li class="nav-item nav-item-1"><a href="../user_guide.html" >User guide: table of contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">8. Nilearn usage examples</a> &#187;</li> 
      </ul>
    </div>
</div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">


<h4> Giving credit </h4>
  <ul class="simple">
    <li><p>Please consider <a href="../authors.html#citing">citing the
                    papers</a>.</p></li>
  </ul>

  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">8.1.4. A introduction tutorial to fMRI decoding</a><ul>
<li><a class="reference internal" href="#retrieve-and-load-the-fmri-data-from-the-haxby-study">8.1.4.1. Retrieve and load the fMRI data from the  Haxby study</a><ul>
<li><a class="reference internal" href="#first-download-the-data">8.1.4.1.1. First download the data</a></li>
<li><a class="reference internal" href="#convert-the-fmri-volume-s-to-a-data-matrix">8.1.4.1.2. Convert the fMRI volume’s to a data matrix</a></li>
<li><a class="reference internal" href="#load-the-behavioral-labels">8.1.4.1.3. Load the behavioral labels</a></li>
<li><a class="reference internal" href="#restrict-the-analysis-to-cats-and-faces">8.1.4.1.4. Restrict the analysis to cats and faces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#decoding-with-an-svm">8.1.4.2. Decoding with an SVM</a></li>
<li><a class="reference internal" href="#measuring-prediction-scores-using-cross-validation">8.1.4.3. Measuring prediction scores using cross-validation</a><ul>
<li><a class="reference internal" href="#manually-leaving-out-data">8.1.4.3.1. Manually leaving out data</a></li>
<li><a class="reference internal" href="#implementing-a-kfold-loop">8.1.4.3.2. Implementing a KFold loop</a></li>
<li><a class="reference internal" href="#cross-validation-with-scikit-learn">8.1.4.3.3. Cross-validation with scikit-learn</a></li>
</ul>
</li>
<li><a class="reference internal" href="#inspecting-the-model-weights">8.1.4.4. Inspecting the model weights</a><ul>
<li><a class="reference internal" href="#turning-the-weights-into-a-nifti-image">8.1.4.4.1. Turning the weights into a nifti image</a></li>
<li><a class="reference internal" href="#plotting-the-svm-weights">8.1.4.4.2. Plotting the SVM weights</a></li>
</ul>
</li>
<li><a class="reference internal" href="#further-reading">8.1.4.5. Further reading</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="plot_3d_and_4d_niimg.html"
                        title="previous chapter">8.1.3. 3D and 4D niimgs: handling and visualizing</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="01_plotting/plot_atlas.html"
                        title="next chapter">8.2.1. Basic Atlas plotting</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Click <a class="reference internal" href="#sphx-glr-download-auto-examples-plot-decoding-tutorial-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="a-introduction-tutorial-to-fmri-decoding">
<span id="sphx-glr-auto-examples-plot-decoding-tutorial-py"></span><h1>8.1.4. A introduction tutorial to fMRI decoding<a class="headerlink" href="#a-introduction-tutorial-to-fmri-decoding" title="Permalink to this headline">¶</a></h1>
<p>Here is a simple tutorial on decoding with nilearn. It reproduces the
Haxby 2001 study on a face vs cat discrimination task in a mask of the
ventral stream.</p>
<p>This tutorial is meant as an introduction to the various steps of a
decoding analysis.</p>
<p>It is not a minimalistic example, as it strives to be didactic. It is not
meant to be copied to analyze new data: many of the steps are unecessary.</p>
<div class="contents local topic" id="contents">
<p class="topic-title first"><strong>Contents</strong></p>
<ul class="simple">
<li><a class="reference internal" href="#retrieve-and-load-the-fmri-data-from-the-haxby-study" id="id1">Retrieve and load the fMRI data from the  Haxby study</a></li>
<li><a class="reference internal" href="#decoding-with-an-svm" id="id2">Decoding with an SVM</a></li>
<li><a class="reference internal" href="#measuring-prediction-scores-using-cross-validation" id="id3">Measuring prediction scores using cross-validation</a></li>
<li><a class="reference internal" href="#inspecting-the-model-weights" id="id4">Inspecting the model weights</a></li>
<li><a class="reference internal" href="#further-reading" id="id5">Further reading</a></li>
</ul>
</div>
<div class="section" id="retrieve-and-load-the-fmri-data-from-the-haxby-study">
<h2><a class="toc-backref" href="#id1">8.1.4.1. Retrieve and load the fMRI data from the  Haxby study</a><a class="headerlink" href="#retrieve-and-load-the-fmri-data-from-the-haxby-study" title="Permalink to this headline">¶</a></h2>
<div class="section" id="first-download-the-data">
<h3>8.1.4.1.1. First download the data<a class="headerlink" href="#first-download-the-data" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../modules/generated/nilearn.datasets.fetch_haxby.html#nilearn.datasets.fetch_haxby" title="nilearn.datasets.fetch_haxby"><code class="xref py py-func docutils literal notranslate"><span class="pre">nilearn.datasets.fetch_haxby</span></code></a> function will download the
Haxby dataset if not present on the disk, in the nilearn data directory.
It can take a while to download about 310 Mo of data from the Internet.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nilearn</span> <span class="k">import</span> <span class="n">datasets</span>
<span class="c1"># By default 2nd subject will be fetched</span>
<span class="n">haxby_dataset</span> <span class="o">=</span> <a href="../modules/generated/nilearn.datasets.fetch_haxby.html#nilearn.datasets.fetch_haxby" title="View documentation for nilearn.datasets.fetch_haxby"><span class="n">datasets</span><span class="o">.</span><span class="n">fetch_haxby</span></a><span class="p">()</span>
<span class="c1"># &#39;func&#39; is a list of filenames: one for each subject</span>
<span class="n">fmri_filename</span> <span class="o">=</span> <span class="n">haxby_dataset</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># print basic information on the dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;First subject functional nifti images (4D) are at: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
      <span class="n">fmri_filename</span><span class="p">)</span>  <span class="c1"># 4D data</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>First subject functional nifti images (4D) are at: /home/kshitij/nilearn_data/haxby2001/subj2/bold.nii.gz
</pre></div>
</div>
</div>
<div class="section" id="convert-the-fmri-volume-s-to-a-data-matrix">
<h3>8.1.4.1.2. Convert the fMRI volume’s to a data matrix<a class="headerlink" href="#convert-the-fmri-volume-s-to-a-data-matrix" title="Permalink to this headline">¶</a></h3>
<p>We will use the <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><code class="xref py py-class docutils literal notranslate"><span class="pre">nilearn.input_data.NiftiMasker</span></code></a> to extract the
fMRI data on a mask and convert it to data series.</p>
<p>The mask is a mask of the Ventral Temporal streaming coming from the
Haxby study:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mask_filename</span> <span class="o">=</span> <span class="n">haxby_dataset</span><span class="o">.</span><span class="n">mask_vt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Let&#39;s visualize it, using the subject&#39;s anatomical image as a</span>
<span class="c1"># background</span>
<span class="kn">from</span> <span class="nn">nilearn</span> <span class="k">import</span> <span class="n">plotting</span>
<a href="../modules/generated/nilearn.plotting.plot_roi.html#nilearn.plotting.plot_roi" title="View documentation for nilearn.plotting.plot_roi"><span class="n">plotting</span><span class="o">.</span><span class="n">plot_roi</span></a><span class="p">(</span><span class="n">mask_filename</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">haxby_dataset</span><span class="o">.</span><span class="n">anat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Paired&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_decoding_tutorial_001.png" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_decoding_tutorial_001.png" />
<p>Now we use the NiftiMasker.</p>
<p>We first create a masker, giving it the options that we care
about. Here we use standardizing of the data, as it is often important
for decoding</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nilearn.input_data</span> <span class="k">import</span> <a href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="View documentation for nilearn.input_data.NiftiMasker"><span class="n">NiftiMasker</span></a>
<span class="n">masker</span> <span class="o">=</span> <a href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="View documentation for nilearn.input_data.NiftiMasker"><span class="n">NiftiMasker</span></a><span class="p">(</span><span class="n">mask_img</span><span class="o">=</span><span class="n">mask_filename</span><span class="p">,</span> <span class="n">standardize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># We give the masker a filename and retrieve a 2D array ready</span>
<span class="c1"># for machine learning with scikit-learn</span>
<span class="n">fmri_masked</span> <span class="o">=</span> <span class="n">masker</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">fmri_filename</span><span class="p">)</span>
</pre></div>
</div>
<p>The variable “fmri_masked” is a numpy array:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fmri_masked</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[[ 7.6757914e-01  2.3108709e+00 -2.0519446e-01 ... -1.0261141e+00
   8.7993503e-02  2.0720530e+00]
 [ 5.5640829e-01  1.6833442e+00 -2.4644940e-01 ... -7.0238096e-01
  -3.4570050e-01  2.0341012e+00]
 [ 7.6757914e-01  1.9186667e+00  1.0802227e-03 ... -9.9374086e-01
  -2.7630946e-01  2.1479564e+00]
 ...
 [-4.2905572e-01 -1.6896113e+00 -7.4150860e-01 ... -1.5440873e+00
   1.8054218e+00 -1.6709729e-01]
 [-1.4749458e-01 -1.8072726e+00 -2.4644940e-01 ... -1.7707006e+00
   1.5452055e+00  7.8169519e-01]
 [-2.1788488e-01 -1.4542887e+00  1.0802227e-03 ... -1.6412073e+00
   1.2676412e+00  8.9555031e-01]]
</pre></div>
</div>
<p>Its shape corresponds to the number of time-points times the number of
voxels in the mask</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fmri_masked</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(1452, 464)
</pre></div>
</div>
</div>
<div class="section" id="load-the-behavioral-labels">
<h3>8.1.4.1.3. Load the behavioral labels<a class="headerlink" href="#load-the-behavioral-labels" title="Permalink to this headline">¶</a></h3>
<p>The behavioral labels are stored in a CSV file, separated by spaces.</p>
<p>We use pandas to load them in an array.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1"># Load behavioral information</span>
<span class="n">behavioral</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">haxby_dataset</span><span class="o">.</span><span class="n">session_target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">behavioral</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>labels  chunks
0         rest       0
1         rest       0
2         rest       0
3         rest       0
4         rest       0
5         rest       0
6     scissors       0
7     scissors       0
8     scissors       0
9     scissors       0
10    scissors       0
11    scissors       0
12    scissors       0
13    scissors       0
14    scissors       0
15        rest       0
16        rest       0
17        rest       0
18        rest       0
19        rest       0
20        rest       0
21        face       0
22        face       0
23        face       0
24        face       0
25        face       0
26        face       0
27        face       0
28        face       0
29        face       0
...        ...     ...
1422      rest      11
1423       cat      11
1424       cat      11
1425       cat      11
1426       cat      11
1427       cat      11
1428       cat      11
1429       cat      11
1430       cat      11
1431       cat      11
1432      rest      11
1433      rest      11
1434      rest      11
1435      rest      11
1436      rest      11
1437  scissors      11
1438  scissors      11
1439  scissors      11
1440  scissors      11
1441  scissors      11
1442  scissors      11
1443  scissors      11
1444  scissors      11
1445  scissors      11
1446      rest      11
1447      rest      11
1448      rest      11
1449      rest      11
1450      rest      11
1451      rest      11

[1452 rows x 2 columns]
</pre></div>
</div>
<p>Retrieve the experimental conditions, that we are going to use as
prediction targets in the decoding</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conditions</span> <span class="o">=</span> <span class="n">behavioral</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>0           rest
1           rest
2           rest
3           rest
4           rest
5           rest
6       scissors
7       scissors
8       scissors
9       scissors
10      scissors
11      scissors
12      scissors
13      scissors
14      scissors
15          rest
16          rest
17          rest
18          rest
19          rest
20          rest
21          face
22          face
23          face
24          face
25          face
26          face
27          face
28          face
29          face
          ...
1422        rest
1423         cat
1424         cat
1425         cat
1426         cat
1427         cat
1428         cat
1429         cat
1430         cat
1431         cat
1432        rest
1433        rest
1434        rest
1435        rest
1436        rest
1437    scissors
1438    scissors
1439    scissors
1440    scissors
1441    scissors
1442    scissors
1443    scissors
1444    scissors
1445    scissors
1446        rest
1447        rest
1448        rest
1449        rest
1450        rest
1451        rest
Name: labels, Length: 1452, dtype: object
</pre></div>
</div>
</div>
<div class="section" id="restrict-the-analysis-to-cats-and-faces">
<h3>8.1.4.1.4. Restrict the analysis to cats and faces<a class="headerlink" href="#restrict-the-analysis-to-cats-and-faces" title="Permalink to this headline">¶</a></h3>
<p>As we can see from the targets above, the experiment contains many
conditions, not all that interest us for decoding.</p>
<p>To keep only data corresponding to faces or cats, we create a
mask of the samples belonging to the condition.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">condition_mask</span> <span class="o">=</span> <span class="n">conditions</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;face&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">])</span>

<span class="c1"># We apply this mask in the sampe direction to restrict the</span>
<span class="c1"># classification to the face vs cat discrimination</span>
<span class="n">fmri_masked</span> <span class="o">=</span> <span class="n">fmri_masked</span><span class="p">[</span><span class="n">condition_mask</span><span class="p">]</span>
</pre></div>
</div>
<p>We now have less samples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fmri_masked</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(216, 464)
</pre></div>
</div>
<p>We apply the same mask to the targets</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conditions</span> <span class="o">=</span> <span class="n">conditions</span><span class="p">[</span><span class="n">condition_mask</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">conditions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(216,)
</pre></div>
</div>
</div>
</div>
<div class="section" id="decoding-with-an-svm">
<h2><a class="toc-backref" href="#id2">8.1.4.2. Decoding with an SVM</a><a class="headerlink" href="#decoding-with-an-svm" title="Permalink to this headline">¶</a></h2>
<p>We will now use the <a class="reference external" href="http://www.scikit-learn.org">scikit-learn</a>
machine-learning toolbox on the fmri_masked data.</p>
<p>As a decoder, we use a Support Vector Classification, with a linear
kernel.</p>
<p>We first create it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="k">import</span> <a href="https://scikit-learn.org/0.18/modules/generated/sklearn.svm.SVC.html#sklearn.svm.SVC" title="View documentation for sklearn.svm.SVC"><span class="n">SVC</span></a>
<span class="n">svc</span> <span class="o">=</span> <a href="https://scikit-learn.org/0.18/modules/generated/sklearn.svm.SVC.html#sklearn.svm.SVC" title="View documentation for sklearn.svm.SVC"><span class="n">SVC</span></a><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">svc</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>SVC(C=1.0, cache_size=200, class_weight=None, coef0=0.0,
  decision_function_shape=&#39;ovr&#39;, degree=3, gamma=&#39;auto_deprecated&#39;,
  kernel=&#39;linear&#39;, max_iter=-1, probability=False, random_state=None,
  shrinking=True, tol=0.001, verbose=False)
</pre></div>
</div>
<p>The svc object is an object that can be fit (or trained) on data with
labels, and then predict labels on data without.</p>
<p>We first fit it on the data</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">svc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fmri_masked</span><span class="p">,</span> <span class="n">conditions</span><span class="p">)</span>
</pre></div>
</div>
<p>We can then predict the labels from the data</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">prediction</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">fmri_masked</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;cat&#39;
 &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39;
 &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39;
 &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39;
 &#39;face&#39; &#39;face&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39;
 &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39;
 &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39;
 &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39;
 &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39;
 &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39;
 &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39;
 &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39;
 &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39;
 &#39;cat&#39; &#39;cat&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39;
 &#39;face&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;face&#39;
 &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39;
 &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39;
 &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39;
 &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39;
 &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39;]
</pre></div>
</div>
<p>Let’s measure the error rate:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">((</span><span class="n">prediction</span> <span class="o">==</span> <span class="n">conditions</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">conditions</span><span class="p">)))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>1.0
</pre></div>
</div>
<p>This error rate is meaningless. Why?</p>
</div>
<div class="section" id="measuring-prediction-scores-using-cross-validation">
<h2><a class="toc-backref" href="#id3">8.1.4.3. Measuring prediction scores using cross-validation</a><a class="headerlink" href="#measuring-prediction-scores-using-cross-validation" title="Permalink to this headline">¶</a></h2>
<p>The proper way to measure error rates or prediction accuracy is via
cross-validation: leaving out some data and testing on it.</p>
<div class="section" id="manually-leaving-out-data">
<h3>8.1.4.3.1. Manually leaving out data<a class="headerlink" href="#manually-leaving-out-data" title="Permalink to this headline">¶</a></h3>
<p>Let’s leave out the 30 last data points during training, and test the
prediction on these 30 last points:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">svc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fmri_masked</span><span class="p">[:</span><span class="o">-</span><span class="mi">30</span><span class="p">],</span> <span class="n">conditions</span><span class="p">[:</span><span class="o">-</span><span class="mi">30</span><span class="p">])</span>

<span class="n">prediction</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">fmri_masked</span><span class="p">[</span><span class="o">-</span><span class="mi">30</span><span class="p">:])</span>
<span class="nb">print</span><span class="p">((</span><span class="n">prediction</span> <span class="o">==</span> <span class="n">conditions</span><span class="p">[</span><span class="o">-</span><span class="mi">30</span><span class="p">:])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">conditions</span><span class="p">[</span><span class="o">-</span><span class="mi">30</span><span class="p">:])))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>0.6666666666666666
</pre></div>
</div>
</div>
<div class="section" id="implementing-a-kfold-loop">
<h3>8.1.4.3.2. Implementing a KFold loop<a class="headerlink" href="#implementing-a-kfold-loop" title="Permalink to this headline">¶</a></h3>
<p>We can split the data in train and test set repetitively in a <cite>KFold</cite>
strategy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <a href="https://scikit-learn.org/0.18/modules/generated/sklearn.model_selection.KFold.html#sklearn.model_selection.KFold" title="View documentation for sklearn.model_selection.KFold"><span class="n">KFold</span></a>

<span class="n">cv</span> <span class="o">=</span> <a href="https://scikit-learn.org/0.18/modules/generated/sklearn.model_selection.KFold.html#sklearn.model_selection.KFold" title="View documentation for sklearn.model_selection.KFold"><span class="n">KFold</span></a><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># The &quot;cv&quot; object&#39;s split method can now accept data and create a</span>
<span class="c1"># generator which can yield the splits.</span>
<span class="k">for</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">fmri_masked</span><span class="p">):</span>
    <span class="n">conditions_masked</span> <span class="o">=</span> <span class="n">conditions</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">train</span><span class="p">]</span>
    <span class="n">svc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fmri_masked</span><span class="p">[</span><span class="n">train</span><span class="p">],</span> <span class="n">conditions_masked</span><span class="p">)</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">fmri_masked</span><span class="p">[</span><span class="n">test</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">((</span><span class="n">prediction</span> <span class="o">==</span> <span class="n">conditions</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">test</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
           <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">conditions</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">test</span><span class="p">])))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>0.9772727272727273
0.7674418604651163
0.7906976744186046
0.5348837209302325
0.7441860465116279
</pre></div>
</div>
</div>
<div class="section" id="cross-validation-with-scikit-learn">
<h3>8.1.4.3.3. Cross-validation with scikit-learn<a class="headerlink" href="#cross-validation-with-scikit-learn" title="Permalink to this headline">¶</a></h3>
<p>Scikit-learn has tools to perform cross-validation easier:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <a href="https://scikit-learn.org/0.18/modules/generated/sklearn.model_selection.cross_val_score.html#sklearn.model_selection.cross_val_score" title="View documentation for sklearn.model_selection.cross_val_score"><span class="n">cross_val_score</span></a>
<span class="n">cv_score</span> <span class="o">=</span> <a href="https://scikit-learn.org/0.18/modules/generated/sklearn.model_selection.cross_val_score.html#sklearn.model_selection.cross_val_score" title="View documentation for sklearn.model_selection.cross_val_score"><span class="n">cross_val_score</span></a><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">fmri_masked</span><span class="p">,</span> <span class="n">conditions</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cv_score</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[0.59722222 0.80555556 0.55555556]
</pre></div>
</div>
<p>Note that we can speed things up to use all the CPUs of our computer
with the n_jobs parameter.</p>
<p>The best way to do cross-validation is to respect the structure of
the experiment, for instance by leaving out full sessions of
acquisition.</p>
<p>The number of the session is stored in the CSV file giving the
behavioral data. We have to apply our session mask, to select only cats
and faces.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">session_label</span> <span class="o">=</span> <span class="n">behavioral</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">][</span><span class="n">condition_mask</span><span class="p">]</span>

<span class="c1"># By default, cross_val_score uses a 3-fold KFold. We can control this by</span>
<span class="c1"># passing the &quot;cv&quot; object, here a 5-fold:</span>
<span class="n">cv_score</span> <span class="o">=</span> <a href="https://scikit-learn.org/0.18/modules/generated/sklearn.model_selection.cross_val_score.html#sklearn.model_selection.cross_val_score" title="View documentation for sklearn.model_selection.cross_val_score"><span class="n">cross_val_score</span></a><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">fmri_masked</span><span class="p">,</span> <span class="n">conditions</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cv_score</span><span class="p">)</span>

<span class="c1"># To leave a session out, pass it to the groups parameter of cross_val_score.</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <a href="https://scikit-learn.org/0.18/modules/generated/sklearn.model_selection.LeaveOneGroupOut.html#sklearn.model_selection.LeaveOneGroupOut" title="View documentation for sklearn.model_selection.LeaveOneGroupOut"><span class="n">LeaveOneGroupOut</span></a>
<span class="n">cv</span> <span class="o">=</span> <a href="https://scikit-learn.org/0.18/modules/generated/sklearn.model_selection.LeaveOneGroupOut.html#sklearn.model_selection.LeaveOneGroupOut" title="View documentation for sklearn.model_selection.LeaveOneGroupOut"><span class="n">LeaveOneGroupOut</span></a><span class="p">()</span>
<span class="n">cv_score</span> <span class="o">=</span> <a href="https://scikit-learn.org/0.18/modules/generated/sklearn.model_selection.cross_val_score.html#sklearn.model_selection.cross_val_score" title="View documentation for sklearn.model_selection.cross_val_score"><span class="n">cross_val_score</span></a><span class="p">(</span><span class="n">svc</span><span class="p">,</span>
                           <span class="n">fmri_masked</span><span class="p">,</span>
                           <span class="n">conditions</span><span class="p">,</span>
                           <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
                           <span class="n">groups</span><span class="o">=</span><span class="n">session_label</span><span class="p">,</span>
                           <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cv_score</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[0.97727273 0.76744186 0.79069767 0.53488372 0.74418605]
[0.55555556 1.         0.66666667 0.66666667 0.77777778 0.72222222
 0.88888889 0.38888889 0.66666667 0.5        0.77777778 0.66666667]
</pre></div>
</div>
</div>
</div>
<div class="section" id="inspecting-the-model-weights">
<h2><a class="toc-backref" href="#id4">8.1.4.4. Inspecting the model weights</a><a class="headerlink" href="#inspecting-the-model-weights" title="Permalink to this headline">¶</a></h2>
<p>Finally, it may be useful to inspect and display the model weights.</p>
<div class="section" id="turning-the-weights-into-a-nifti-image">
<h3>8.1.4.4.1. Turning the weights into a nifti image<a class="headerlink" href="#turning-the-weights-into-a-nifti-image" title="Permalink to this headline">¶</a></h3>
<p>We retrieve the SVC discriminating weights</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">coef_</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">coef_</span>
<span class="nb">print</span><span class="p">(</span><span class="n">coef_</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[[-4.10591439e-02 -8.38913669e-04 -2.34992127e-02 -3.47431514e-02
   3.44100694e-02  2.59043472e-02  2.39052353e-02 -4.95012599e-02
  -3.19443415e-02 -1.65893786e-02  1.87552899e-02 -7.78939157e-03
   1.02022966e-02 -3.23066175e-02  4.77513388e-03  2.20187375e-02
   1.50985089e-02  1.77166050e-03  2.41532650e-02 -3.24624084e-02
   1.30955876e-02 -9.66231411e-02 -7.07582442e-02  1.92832959e-02
   3.57739471e-02 -1.44028906e-02 -9.17654420e-03 -3.23610315e-02
   2.34853293e-02  1.01923043e-01  1.61348815e-02 -7.79778695e-02
   2.49681620e-03 -3.13738572e-02 -2.80103975e-02 -5.16189181e-02
  -6.94717904e-03 -1.00566568e-02 -2.96087048e-02 -2.25467990e-02
  -3.00431368e-02 -3.28028599e-02  2.65750951e-02  1.66043690e-02
  -1.63196266e-02  3.33049535e-02  4.58224672e-04  7.30845484e-03
   2.85276988e-02  1.98812475e-02  2.65800328e-02  1.87685655e-02
  -2.05262911e-02 -9.08269461e-03 -4.53160560e-02  1.59140903e-02
  -1.75433965e-02 -6.90762579e-02  3.89501904e-02 -1.28822089e-01
  -3.50391659e-02  6.48267437e-03  5.01267951e-02 -7.63127896e-02
  -1.70264978e-02  5.40262082e-03  5.61464364e-02 -1.73917761e-02
   7.37187399e-02  1.29712224e-02  3.31590258e-02  6.15625548e-03
   4.10859945e-02 -6.77459982e-03  7.23131333e-03  2.18362878e-02
   3.84148397e-02  2.63664841e-02  1.74112933e-02  1.61460386e-02
   2.82263367e-02 -5.51453962e-03 -1.24329869e-02 -1.65007919e-02
   1.53495049e-03 -3.58689292e-02 -2.45351639e-02 -4.79747313e-03
  -5.32036709e-02  3.68274125e-02 -1.69981985e-02  1.08511387e-02
  -4.80508461e-02 -3.69829093e-02 -4.36149708e-02 -2.27505354e-02
  -1.82647161e-02 -1.29988416e-02  3.45534849e-02  7.32459494e-03
  -5.96338242e-03  5.11828907e-02  1.78048855e-02 -4.10786820e-02
   3.44218340e-02  1.02061855e-02  3.24182697e-02  3.40190648e-02
  -9.72497936e-03  2.21466123e-02  1.51944122e-02 -5.13909282e-02
  -2.25212663e-02 -5.36059085e-02  1.74461316e-02 -1.73912821e-02
  -5.30948812e-02  4.28375575e-02 -1.75974389e-02  2.65186313e-03
  -2.93060690e-02 -2.90011563e-02  1.88280315e-02 -3.77559429e-02
   2.82039100e-03  4.76274597e-02  3.82002135e-02  7.30823353e-03
  -5.78025756e-02  4.88796086e-03  2.08386543e-02  3.10799309e-06
   7.64731722e-05 -5.30726179e-03  8.32036061e-04  6.96334682e-03
  -2.52437504e-02 -1.01739725e-02 -1.62671356e-02  3.42707627e-02
   1.00432285e-02 -2.50394237e-02 -6.19833205e-03 -2.77334894e-02
  -1.03254429e-02 -1.42163226e-02  3.39557786e-03  5.27978096e-02
  -2.05438140e-02 -5.70770065e-02  1.02214240e-02 -5.51708996e-02
  -1.29624200e-02  3.77777072e-03  7.88352021e-03  1.51368300e-02
   5.94512230e-02  3.75684469e-02  4.61933687e-02 -6.28617029e-03
  -2.31685868e-03  4.39664384e-02  6.82138779e-02  1.58698406e-02
   5.48997068e-02  8.31410463e-02 -8.97988526e-03  7.83481005e-03
   2.26074506e-02 -2.60458600e-02  4.45277489e-02 -2.86097190e-02
  -4.99059962e-02  1.71997729e-03  3.65673224e-02  8.15741229e-04
   1.83704939e-02  5.17197092e-02  6.35578528e-03  7.05183282e-04
   1.64023420e-02  4.50576924e-03  3.11797770e-02 -3.37322280e-03
  -1.27150811e-02 -2.60359954e-02  1.47512619e-02  6.84497712e-02
   1.07656559e-02  1.99667580e-02  7.49694140e-03 -3.16838856e-02
   3.10212576e-02 -1.52473819e-04 -3.06834455e-02 -1.12419283e-02
  -2.01262203e-02  1.44459697e-02  1.89684619e-02  1.71060489e-02
  -6.42078682e-02  2.56285714e-03 -6.97908819e-02  4.37415790e-02
  -2.19265925e-02  2.75412496e-02  2.26371659e-02  6.08747457e-03
   7.00948041e-02 -5.47876565e-02  5.00929706e-03 -1.32239805e-02
  -1.67932274e-02 -2.90672109e-02 -4.34679793e-02 -2.32697607e-02
  -1.14648197e-01  1.08002999e-03 -1.34715639e-02 -2.42857355e-02
   4.32411447e-03 -7.01753153e-03 -5.78315906e-02 -1.63359362e-02
  -7.83189241e-02 -6.56549588e-02  1.59472704e-02 -3.93885430e-02
   3.70071579e-02 -8.53304624e-02 -1.46804768e-02 -3.66368426e-02
   6.33237317e-04  3.15900362e-02 -3.74878316e-02 -2.36906438e-02
  -3.48493077e-02 -1.29455374e-02  3.04677148e-02 -5.92433891e-03
  -2.96713551e-02 -1.06306524e-02 -4.51622456e-02 -1.39410348e-02
  -3.72100330e-02  7.48408861e-03 -5.96724188e-02  6.34547444e-02
   3.87715096e-02  3.48643739e-03 -3.29345516e-02 -2.05291736e-02
   3.74104677e-02 -5.28466371e-02 -5.24368180e-02 -1.08615834e-01
  -3.93677233e-02  2.73577934e-02 -1.15112257e-02 -3.11615139e-02
   2.96191093e-02 -1.56250888e-02  8.23424923e-03 -2.21058103e-02
   1.46964377e-02  2.33201228e-02  2.13609673e-02 -8.54915916e-04
   9.25025018e-02  8.45063327e-03  4.39500980e-02 -7.08333209e-02
  -2.79867591e-02  1.02058740e-02 -6.08684855e-02  6.20570031e-03
   3.75086657e-02  9.68286171e-02  4.41023193e-02  4.73388356e-02
   3.91426944e-02 -1.99352505e-02  7.03359502e-03 -2.44020595e-02
  -2.99892130e-02 -3.25777097e-02  2.72322372e-03  7.77638452e-03
   5.01101070e-02  9.72297020e-03  8.82609430e-03  1.97665762e-02
   1.24510717e-03 -2.57096538e-03  3.11640278e-03  2.92457840e-02
   6.42228310e-03 -9.54802550e-03 -4.14943422e-02 -2.03235930e-02
  -4.09358168e-02  6.34522456e-03  3.81027536e-02 -1.24257807e-03
  -1.35866182e-02  3.19962258e-03  4.15927262e-03  2.61804263e-02
   6.27312985e-02 -9.58309235e-03 -3.81101069e-02 -8.98117138e-03
  -4.78051891e-03 -5.94786274e-02  3.94663899e-02  6.07790784e-02
  -8.31262780e-03 -6.94258109e-03  4.99962896e-02  2.73733671e-02
  -5.71262633e-03 -1.84389576e-03  1.76737707e-01  1.14519296e-02
  -3.12318244e-02  3.35009779e-02  5.39812542e-03 -1.24046393e-02
  -3.01223574e-02 -2.34884768e-02 -4.04753625e-02 -3.31808379e-02
  -3.44700460e-02  4.34950149e-03 -1.12128351e-02  2.66120489e-02
  -2.08353307e-02 -5.55524566e-02  9.02084978e-02 -5.42311876e-03
   4.40591115e-02 -3.83539141e-02 -1.54222839e-03 -2.17430721e-02
   2.45192255e-02 -1.80792703e-02  4.16507360e-02  3.39222577e-03
   1.35898003e-02  5.62169808e-02  2.05511201e-02  5.22713085e-02
   5.72247210e-02 -8.37975269e-03  4.06737553e-02  5.04869536e-03
   8.32129801e-02 -3.55796178e-02  5.42543214e-03  3.00522892e-02
  -2.63670321e-02 -2.92756811e-02 -8.30947903e-02 -1.35585937e-02
  -2.90020763e-02  1.64358003e-02 -2.01398046e-02 -1.03980476e-02
  -2.06189132e-03  7.90399394e-02 -3.72163735e-02 -1.83636584e-02
  -2.12257025e-02  2.37873219e-02  7.58760375e-02  3.17983915e-02
   2.44485483e-02 -2.00030934e-03 -6.50080563e-03 -3.43038946e-03
  -9.17293632e-03  2.16091063e-02 -1.86680470e-03 -8.67444519e-02
  -3.76717846e-02  1.93650951e-02  3.42706125e-02 -1.84720711e-02
  -5.55555972e-02 -2.37116507e-02  5.81776873e-02 -8.53892872e-03
  -2.07530777e-02 -8.53067546e-04  2.72667521e-02 -3.51271213e-03
   2.06427064e-02 -8.93358005e-03 -6.59351511e-04 -1.36124161e-02
   3.95871060e-02  2.60889355e-02 -4.33492580e-03 -1.18201950e-02
  -1.91292290e-02 -2.46696785e-02  2.43858751e-02  5.70631381e-03
  -2.25983571e-02  3.35543974e-02  2.40025148e-03  9.97905075e-03
   2.38300137e-02  4.01035787e-02  4.73236294e-02 -3.05304529e-02
  -3.46325886e-02  8.39215710e-04 -4.89761870e-02  6.89462038e-03
  -6.43273366e-02 -6.98259848e-02  5.46324448e-02 -3.85178692e-02
  -1.88327596e-02  2.04875750e-02  2.30507846e-02  2.90462605e-02
  -5.97637507e-03  4.81619008e-02  2.38865302e-02  3.72272632e-03
   4.98869102e-02 -4.44756682e-02  7.97887018e-03 -2.10699182e-02
   5.06694017e-02 -7.28995658e-02 -2.29531446e-02  2.04757321e-02
  -4.30773655e-02 -4.20149354e-02  1.34561591e-02  2.11104965e-02
   1.25247353e-02 -3.91501850e-02 -2.81964084e-02  5.69533437e-03
  -5.09280045e-02  3.13800843e-02 -6.28572542e-03 -5.08252999e-02
   1.54894409e-02  2.86118800e-02  4.85921862e-02 -3.17075185e-03
   2.22448348e-02  1.68500752e-02  2.89099486e-02 -2.41337610e-02
  -1.78519517e-02  6.16670437e-03 -3.18354357e-02  1.94965342e-02]]
</pre></div>
</div>
<p>It’s a numpy array</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">coef_</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(1, 464)
</pre></div>
</div>
<p>We need to turn it back into a Nifti image, in essence, “inverting”
what the NiftiMasker has done.</p>
<p>For this, we can call inverse_transform on the NiftiMasker:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">coef_img</span> <span class="o">=</span> <span class="n">masker</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">coef_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">coef_img</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;nibabel.nifti1.Nifti1Image&#39;&gt;
data shape (40, 64, 64, 1)
affine:
[[  -3.5      0.       0.      68.25 ]
 [   0.       3.75     0.    -118.125]
 [   0.       0.       3.75  -118.125]
 [   0.       0.       0.       1.   ]]
metadata:
&lt;class &#39;nibabel.nifti1.Nifti1Header&#39;&gt; object, endian=&#39;&lt;&#39;
sizeof_hdr      : 348
data_type       : b&#39;&#39;
db_name         : b&#39;&#39;
extents         : 0
session_error   : 0
regular         : b&#39;&#39;
dim_info        : 0
dim             : [ 4 40 64 64  1  1  1  1]
intent_p1       : 0.0
intent_p2       : 0.0
intent_p3       : 0.0
intent_code     : none
datatype        : float64
bitpix          : 64
slice_start     : 0
pixdim          : [-1.    3.5   3.75  3.75  1.    1.    1.    1.  ]
vox_offset      : 0.0
scl_slope       : nan
scl_inter       : nan
slice_end       : 0
slice_code      : unknown
xyzt_units      : 0
cal_max         : 0.0
cal_min         : 0.0
slice_duration  : 0.0
toffset         : 0.0
glmax           : 0
glmin           : 0
descrip         : b&#39;&#39;
aux_file        : b&#39;&#39;
qform_code      : unknown
sform_code      : aligned
quatern_b       : 0.0
quatern_c       : 1.0
quatern_d       : 0.0
qoffset_x       : 68.25
qoffset_y       : -118.125
qoffset_z       : -118.125
srow_x          : [-3.5   0.    0.   68.25]
srow_y          : [   0.       3.75     0.    -118.125]
srow_z          : [   0.       0.       3.75  -118.125]
intent_name     : b&#39;&#39;
magic           : b&#39;n+1&#39;
</pre></div>
</div>
<p>coef_img is now a NiftiImage.</p>
<p>We can save the coefficients as a nii.gz file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">coef_img</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="s1">&#39;haxby_svc_weights.nii.gz&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="plotting-the-svm-weights">
<h3>8.1.4.4.2. Plotting the SVM weights<a class="headerlink" href="#plotting-the-svm-weights" title="Permalink to this headline">¶</a></h3>
<p>We can plot the weights, using the subject’s anatomical as a background</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nilearn.plotting</span> <span class="k">import</span> <a href="../modules/generated/nilearn.plotting.plot_stat_map.html#nilearn.plotting.plot_stat_map" title="View documentation for nilearn.plotting.plot_stat_map"><span class="n">plot_stat_map</span></a><span class="p">,</span> <a href="../modules/generated/nilearn.plotting.show.html#nilearn.plotting.show" title="View documentation for nilearn.plotting.show"><span class="n">show</span></a>

<a href="../modules/generated/nilearn.plotting.plot_stat_map.html#nilearn.plotting.plot_stat_map" title="View documentation for nilearn.plotting.plot_stat_map"><span class="n">plot_stat_map</span></a><span class="p">(</span><span class="n">coef_img</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">haxby_dataset</span><span class="o">.</span><span class="n">anat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
              <span class="n">title</span><span class="o">=</span><span class="s2">&quot;SVM weights&quot;</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s2">&quot;yx&quot;</span><span class="p">)</span>

<a href="../modules/generated/nilearn.plotting.show.html#nilearn.plotting.show" title="View documentation for nilearn.plotting.show"><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_decoding_tutorial_002.png" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_decoding_tutorial_002.png" />
</div>
</div>
<div class="section" id="further-reading">
<h2><a class="toc-backref" href="#id5">8.1.4.5. Further reading</a><a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>The <a class="reference internal" href="../decoding/index.html#decoding"><span class="std std-ref">section of the documentation on decoding</span></a></li>
<li><a class="reference internal" href="02_decoding/plot_haxby_anova_svm.html#sphx-glr-auto-examples-02-decoding-plot-haxby-anova-svm-py"><span class="std std-ref">Decoding with ANOVA + SVM: face vs house in the Haxby dataset</span></a>
For decoding without a precomputed mask</li>
<li><a class="reference internal" href="../decoding/space_net.html#space-net"><span class="std std-ref">SpaceNet: decoding with spatial structure for better maps</span></a></li>
</ul>
<hr class="docutils" />
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  13.814 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-plot-decoding-tutorial-py">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" download="" href="../_downloads/7c4097f735ffe2a90c2aaead67a36b8b/plot_decoding_tutorial.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_decoding_tutorial.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" download="" href="../_downloads/5ee48287fd3fcbe193e7aba03f29c04c/plot_decoding_tutorial.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_decoding_tutorial.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
            &copy; The nilearn developers 2010-2015.
          Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.8.2.
        <span style="padding-left: 5ex;">
          <a href="../_sources/auto_examples/plot_decoding_tutorial.rst.txt"
        	 rel="nofollow">Show this page source</a>
        </span>
    </div>
  </body>
</html>