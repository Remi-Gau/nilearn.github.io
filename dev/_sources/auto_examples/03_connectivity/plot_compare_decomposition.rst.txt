
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/03_connectivity/plot_compare_decomposition.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_03_connectivity_plot_compare_decomposition.py>`
        to download the full example code or to run this example in your browser via Binder

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_03_connectivity_plot_compare_decomposition.py:


Deriving spatial maps from group fMRI data using ICA and Dictionary Learning
============================================================================

Various approaches exist to derive spatial maps or networks from
group fmr data. The methods extract distributed brain regions that
exhibit similar :term:`BOLD` fluctuations over time. Decomposition
methods allow for generation of many independent maps simultaneously
without the need to provide a priori information (e.g. seeds or priors.)

This example will apply two popular decomposition methods, :term:`ICA` and
:term:`Dictionary learning`, to :term:`fMRI` data measured while children
and young adults watch movies. The resulting maps will be visualized using
atlas plotting tools.

:term:`CanICA` is an :term:`ICA` method
for group-level analysis of :term:`fMRI` data.
Compared to other strategies, it brings a well-controlled group model,
as well as a
thresholding algorithm controlling for specificity and sensitivity with
an explicit model of the signal.

The reference paper is :footcite:t:`Varoquaux2010c`.

.. GENERATED FROM PYTHON SOURCE LINES 27-29

Load brain development :term:`fMRI` dataset
-------------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 29-38

.. code-block:: Python

    from nilearn import datasets

    rest_dataset = datasets.fetch_development_fmri(n_subjects=30)
    func_filenames = rest_dataset.func  # list of 4D nifti files for each subject

    # print basic information on the dataset
    print(f"First functional nifti image (4D) is at: {rest_dataset.func[0]}")






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Downloading data from https://osf.io/download/5c8ff3e14712b400183b7097/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3e32286e80018c3e42c/ ...
     ...done. (3 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3e4a743a9001760814f/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3e54712b400183b70a5/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3e52286e80018c3e439/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3e72286e80017c41b3d/ ...
     ...done. (3 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3e9a743a90017608158/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3e82286e80018c3e443/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3ea4712b400183b70b7/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3eb2286e80019c3c194/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff37e2286e80016c3c2cb/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3832286e80019c3c10f/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3822286e80018c3e37b/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff382a743a90018606df8/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3814712b4001a3b5561/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3832286e80016c3c2d1/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3842286e80017c419e0/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3854712b4001a3b5568/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5cb4702f39926900171090ee/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5cb46e8b353c58001c9abe98/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3872286e80017c419ea/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3872286e80017c419e9/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3884712b400183b7023/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3884712b400193b5b5c/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff389a743a9001660a016/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff38c2286e80016c3c2da/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff38ca743a90018606dfe/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff38ca743a9001760809e/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5cb47056353c58001c9ac064/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5cb46e5af2be3c001801f799/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5cb4703bf2be3c001801fa49/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5cb46e92a3bc970019f0717f/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff38c4712b4001a3b5573/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff38da743a900176080a2/ ...
     ...done. (3 seconds, 0 min)
    Downloading data from https://osf.io/download/5cb47016a3bc970017efe44f/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5cb46e43f2be3c0017056b8a/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5cb470413992690018133d8c/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5cb46e9a353c58001c9abeac/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff38f2286e80018c3e38d/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3914712b4001a3b5579/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5cb4702a353c58001b9cb5ae/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5cb46e9b39926900190fad5c/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff391a743a900176080a9/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3914712b400173b5329/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5cb47023353c58001c9ac02b/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5cb46eaa39926900160f69af/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3912286e80018c3e393/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5c8ff3952286e80017c41a1b/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5cb47045a3bc970019f073a0/ ...
     ...done. (2 seconds, 0 min)
    Downloading data from https://osf.io/download/5cb46e913992690018133b1c/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5cb47052f2be3c0017057069/ ...
     ...done. (1 seconds, 0 min)
    Downloading data from https://osf.io/download/5cb46e5c353c5800199ac79f/ ...
     ...done. (2 seconds, 0 min)
    First functional nifti image (4D) is at: /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar123_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz




.. GENERATED FROM PYTHON SOURCE LINES 39-44

Apply :term:`CanICA` on the data
--------------------------------
We use "whole-brain-template" as a strategy to compute the mask,
as this leads to slightly faster and more reproducible results.
However, the images need to be in :term:`MNI` template space.

.. GENERATED FROM PYTHON SOURCE LINES 44-72

.. code-block:: Python


    from nilearn.decomposition import CanICA

    canica = CanICA(
        n_components=20,
        memory="nilearn_cache",
        memory_level=2,
        verbose=10,
        mask_strategy="whole-brain-template",
        random_state=0,
        standardize="zscore_sample",
        n_jobs=2,
    )
    canica.fit(func_filenames)

    # Retrieve the independent components in brain space. Directly
    # accessible through attribute `components_img_`.
    canica_components_img = canica.components_img_
    # components_img is a Nifti Image object, and can be saved to a file with
    # the following lines:
    from pathlib import Path

    output_dir = Path.cwd() / "results" / "plot_compare_decomposition"
    output_dir.mkdir(exist_ok=True, parents=True)
    print(f"Output will be saved to: {output_dir}")
    canica_components_img.to_filename(output_dir / "canica_resting_state.nii.gz")






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    [MultiNiftiMasker.fit] Loading data from [/home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar123_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar124_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar125_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar126_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar127_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar128_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar001_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar002_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar003_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar004_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar005_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar006_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar007_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar008_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar009_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar010_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar011_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar012_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar013_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar014_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar015_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar016_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar017_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar018_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar019_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar020_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar021_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar022_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar023_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar024_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz].
    [{self.__class__.__name__}.fit] Computing mask
    /opt/hostedtoolcache/Python/3.12.2/x64/lib/python3.12/site-packages/joblib/memory.py:693: UserWarning:

    Cannot inspect object functools.partial(<function compute_multi_brain_mask at 0x7f1aa1c48720>, mask_type='whole-brain'), ignore list will not work.

    Template whole-brain mask computation
    /opt/hostedtoolcache/Python/3.12.2/x64/lib/python3.12/site-packages/joblib/memory.py:887: UserWarning:

    Cannot inspect object functools.partial(<function compute_multi_brain_mask at 0x7f1aa1c48720>, mask_type='whole-brain'), ignore list will not work.

    /opt/hostedtoolcache/Python/3.12.2/x64/lib/python3.12/site-packages/joblib/memory.py:693: UserWarning:

    Cannot inspect object functools.partial(<function compute_multi_brain_mask at 0x7f1aa1c48720>, mask_type='whole-brain'), ignore list will not work.

    [MultiNiftiMasker.transform] Resampling mask
    [CanICA] Loading data
    ________________________________________________________________________________
    [Memory] Calling sklearn.utils.extmath.randomized_svd...
    randomized_svd(array([[0.003659, ..., 0.013254],
           ...,
           [0.012477, ..., 0.002881]]), n_components=20, transpose=True, random_state=0, n_iter=3)
    ___________________________________________________randomized_svd - 0.7s, 0.0min
    [Parallel(n_jobs=2)]: Using backend LokyBackend with 2 concurrent workers.
    [Parallel(n_jobs=2)]: Done   1 tasks      | elapsed:    2.7s
    [Parallel(n_jobs=2)]: Done   4 tasks      | elapsed:    5.5s
    [Parallel(n_jobs=2)]: Done  10 out of  10 | elapsed:   13.8s finished
    Output will be saved to: /home/runner/work/nilearn/nilearn/examples/03_connectivity/results/plot_compare_decomposition




.. GENERATED FROM PYTHON SOURCE LINES 73-74

To visualize we plot the outline of all components on one figure

.. GENERATED FROM PYTHON SOURCE LINES 74-80

.. code-block:: Python

    from nilearn.plotting import plot_prob_atlas

    # Plot all ICA components together
    plot_prob_atlas(canica_components_img, title="All ICA components")





.. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_001.png
   :alt: plot compare decomposition
   :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    /opt/hostedtoolcache/Python/3.12.2/x64/lib/python3.12/site-packages/nilearn/plotting/displays/_axes.py:74: UserWarning:

    linewidths is ignored by contourf

    /opt/hostedtoolcache/Python/3.12.2/x64/lib/python3.12/site-packages/numpy/ma/core.py:2820: UserWarning:

    Warning: converting a masked element to nan.


    <nilearn.plotting.displays._slicers.OrthoSlicer object at 0x7f1a980cfd10>



.. GENERATED FROM PYTHON SOURCE LINES 81-82

Finally, we plot the map for each :term:`ICA` component separately

.. GENERATED FROM PYTHON SOURCE LINES 82-95

.. code-block:: Python

    from nilearn.image import iter_img
    from nilearn.plotting import plot_stat_map, show

    for i, cur_img in enumerate(iter_img(canica_components_img)):
        plot_stat_map(
            cur_img,
            display_mode="z",
            title=f"IC {int(i)}",
            cut_coords=1,
            colorbar=False,
        )





.. rst-class:: sphx-glr-horizontal


    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_002.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_002.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_003.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_003.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_004.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_004.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_005.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_005.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_006.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_006.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_007.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_007.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_008.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_008.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_009.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_009.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_010.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_010.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_011.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_011.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_012.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_012.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_013.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_013.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_014.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_014.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_015.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_015.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_016.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_016.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_017.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_017.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_018.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_018.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_019.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_019.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_020.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_020.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_021.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_021.png
         :class: sphx-glr-multi-img





.. GENERATED FROM PYTHON SOURCE LINES 96-105

Compare :term:`CanICA` to dictionary learning
---------------------------------------------
:term:`Dictionary learning` is a sparsity based decomposition method
for extracting spatial maps. It extracts maps that are naturally sparse
and usually cleaner than :term:`ICA`. Here, we will compare networks built
with :term:`CanICA` to networks built with :term:`Dictionary learning`.

For more detailse see :footcite:t:`Mensch2016`.


.. GENERATED FROM PYTHON SOURCE LINES 108-109

Create a dictionary learning estimator

.. GENERATED FROM PYTHON SOURCE LINES 109-135

.. code-block:: Python

    from nilearn.decomposition import DictLearning

    dict_learning = DictLearning(
        n_components=20,
        memory="nilearn_cache",
        memory_level=2,
        verbose=1,
        random_state=0,
        n_epochs=1,
        mask_strategy="whole-brain-template",
        standardize="zscore_sample",
        n_jobs=2,
    )

    print("[Example] Fitting dictionary learning model")
    dict_learning.fit(func_filenames)
    print("[Example] Saving results")
    # Grab extracted components umasked back to Nifti image.
    # Note: For older versions, less than 0.4.1. components_img_
    # is not implemented. See Note section above for details.
    dictlearning_components_img = dict_learning.components_img_
    dictlearning_components_img.to_filename(
        output_dir / "dictionary_learning_resting_state.nii.gz"
    )






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    [Example] Fitting dictionary learning model
    [MultiNiftiMasker.fit] Loading data from [/home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar123_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar124_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar125_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar126_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar127_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar128_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar001_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar002_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar003_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar004_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar005_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar006_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar007_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar008_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar009_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar010_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar011_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar012_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar013_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar014_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar015_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar016_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar017_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar018_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar019_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar020_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar021_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar022_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar023_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz,
     /home/runner/work/nilearn/nilearn/nilearn_data/development_fmri/development_fmri/sub-pixar024_task-pixar_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz].
    [{self.__class__.__name__}.fit] Computing mask
    /opt/hostedtoolcache/Python/3.12.2/x64/lib/python3.12/site-packages/joblib/memory.py:693: UserWarning:

    Cannot inspect object functools.partial(<function compute_multi_brain_mask at 0x7f1aa1c48720>, mask_type='whole-brain'), ignore list will not work.

    /opt/hostedtoolcache/Python/3.12.2/x64/lib/python3.12/site-packages/joblib/memory.py:887: UserWarning:

    Cannot inspect object functools.partial(<function compute_multi_brain_mask at 0x7f1aa1c48720>, mask_type='whole-brain'), ignore list will not work.

    /opt/hostedtoolcache/Python/3.12.2/x64/lib/python3.12/site-packages/joblib/memory.py:693: UserWarning:

    Cannot inspect object functools.partial(<function compute_multi_brain_mask at 0x7f1aa1c48720>, mask_type='whole-brain'), ignore list will not work.

    [MultiNiftiMasker.transform] Resampling mask
    [DictLearning] Loading data
    [DictLearning] Learning initial components
    ________________________________________________________________________________
    [Memory] Calling sklearn.utils.extmath.randomized_svd...
    randomized_svd(array([[-0.001315, ...,  0.004387],
           ...,
           [ 0.011243, ...,  0.004194]]), n_components=20, transpose=True, random_state=0, n_iter=3)
    ___________________________________________________randomized_svd - 0.6s, 0.0min
    [Parallel(n_jobs=2)]: Using backend LokyBackend with 2 concurrent workers.
    [DictLearning] Computing initial loadings
    ________________________________________________________________________________
    [Memory] Calling nilearn.decomposition.dict_learning._compute_loadings...
    _compute_loadings(array([[ 0.002971, ...,  0.009535],
           ...,
           [-0.001195, ..., -0.005175]]), 
    array([[-0.622651, ...,  5.322742],
           ...,
           [ 0.777205, ...,  0.743122]]))
    _________________________________________________compute_loadings - 0.2s, 0.0min
    [DictLearning] Learning dictionary
    ________________________________________________________________________________
    [Memory] Calling sklearn.decomposition._dict_learning.dict_learning_online...
    dict_learning_online(array([[-0.622651, ...,  0.777205],
           ...,
           [ 5.322742, ...,  0.743122]]), 
    20, alpha=10, batch_size=20, method='cd', dict_init=array([[-0.150862, ...,  0.097511],
           ...,
           [-0.284606, ..., -0.035436]]), verbose=0, random_state=0, return_code=True, shuffle=True, n_jobs=1, max_iter=1090)
    _____________________________________________dict_learning_online - 1.6s, 0.0min
    [Example] Saving results




.. GENERATED FROM PYTHON SOURCE LINES 136-139

Visualize the results

First plot all DictLearning components together

.. GENERATED FROM PYTHON SOURCE LINES 139-144

.. code-block:: Python

    plot_prob_atlas(
        dictlearning_components_img, title="All DictLearning components"
    )





.. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_022.png
   :alt: plot compare decomposition
   :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_022.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    /opt/hostedtoolcache/Python/3.12.2/x64/lib/python3.12/site-packages/nilearn/plotting/displays/_axes.py:74: UserWarning:

    linewidths is ignored by contourf


    <nilearn.plotting.displays._slicers.OrthoSlicer object at 0x7f1aab5f62d0>



.. GENERATED FROM PYTHON SOURCE LINES 145-146

One plot of each component

.. GENERATED FROM PYTHON SOURCE LINES 146-156

.. code-block:: Python


    for i, cur_img in enumerate(iter_img(dictlearning_components_img)):
        plot_stat_map(
            cur_img,
            display_mode="z",
            title=f"Comp {int(i)}",
            cut_coords=1,
            colorbar=False,
        )




.. rst-class:: sphx-glr-horizontal


    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_023.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_023.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_024.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_024.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_025.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_025.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_026.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_026.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_027.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_027.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_028.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_028.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_029.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_029.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_030.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_030.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_031.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_031.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_032.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_032.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_033.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_033.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_034.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_034.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_035.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_035.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_036.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_036.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_037.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_037.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_038.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_038.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_039.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_039.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_040.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_040.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_041.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_041.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_042.png
         :alt: plot compare decomposition
         :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_042.png
         :class: sphx-glr-multi-img





.. GENERATED FROM PYTHON SOURCE LINES 157-161

Estimate explained variance per component and plot using matplotlib

The fitted object `dict_learning` can be used
to calculate the score per component

.. GENERATED FROM PYTHON SOURCE LINES 161-179

.. code-block:: Python

    scores = dict_learning.score(func_filenames, per_component=True)

    # Plot the scores
    import numpy as np
    from matplotlib import pyplot as plt
    from matplotlib.ticker import FormatStrFormatter

    plt.figure(figsize=(4, 4))
    positions = np.arange(len(scores))
    plt.barh(positions, scores)
    plt.ylabel("Component #", size=12)
    plt.xlabel("Explained variance", size=12)
    plt.yticks(np.arange(20))
    plt.gca().xaxis.set_major_formatter(FormatStrFormatter("%.3f"))
    plt.tight_layout()

    show()




.. image-sg:: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_043.png
   :alt: plot compare decomposition
   :srcset: /auto_examples/03_connectivity/images/sphx_glr_plot_compare_decomposition_043.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    ________________________________________________________________________________
    [Memory] Calling nilearn.decomposition._base._explained_variance...
    _explained_variance(array([[-6.227098e-01, ...,  5.322679e+00],
           ...,
           [ 2.564968e-17, ..., -3.349425e-16]]), 
    array([[-0., ...,  0.],
           ...,
           [ 0., ...,  0.]]), per_component=True)
    /opt/hostedtoolcache/Python/3.12.2/x64/lib/python3.12/site-packages/nilearn/decomposition/_base.py:539: UserWarning:

    Persisting input arguments took 1.30s to run.If this happens often in your code, it can cause performance problems (results will be correct in all cases). The reason for this is probably some large input arguments for a wrapped function.

    ______________________________________________explained_variance - 15.4s, 0.3min




.. GENERATED FROM PYTHON SOURCE LINES 180-186

.. note::

    To see how to extract subject-level timeseries' from regions
    created using :term:`Dictionary learning`, see :ref:`example Regions
    extraction using dictionary learning and functional connectomes
    <sphx_glr_auto_examples_03_connectivity_plot_extract_regions_dictlearning_maps.py>`.

.. GENERATED FROM PYTHON SOURCE LINES 188-192

References
----------

 .. footbibliography::


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (4 minutes 2.207 seconds)

**Estimated memory usage:**  2881 MB


.. _sphx_glr_download_auto_examples_03_connectivity_plot_compare_decomposition.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: binder-badge

      .. image:: images/binder_badge_logo.svg
        :target: https://mybinder.org/v2/gh/nilearn/nilearn/main?urlpath=lab/tree/notebooks/auto_examples/03_connectivity/plot_compare_decomposition.ipynb
        :alt: Launch binder
        :width: 150 px

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_compare_decomposition.ipynb <plot_compare_decomposition.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_compare_decomposition.py <plot_compare_decomposition.py>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
